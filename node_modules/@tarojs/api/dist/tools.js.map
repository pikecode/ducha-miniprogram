{"version":3,"file":"tools.js","sources":["../src/tools.ts"],"sourcesContent":["import { isFunction, isObject } from '@tarojs/shared'\n\nexport function Behavior (options) {\n  return options\n}\n\nexport function getPreload (current) {\n  return function (key: any, val: unknown) {\n    current.preloadData = isObject(key)\n      ? key\n      : {\n        [key]: val\n      }\n  }\n}\n\nconst defaultDesignWidth = 750\nconst defaultDesignRatio = {\n  640: 2.34 / 2,\n  750: 1,\n  828: 1.81 / 2\n}\nconst defaultBaseFontSize = 20\nconst defaultUnitPrecision = 5\nconst defaultTargetUnit = 'rpx'\n\nexport function getInitPxTransform (taro) {\n  return function (config) {\n    const {\n      designWidth = defaultDesignWidth,\n      deviceRatio = defaultDesignRatio,\n      baseFontSize = defaultBaseFontSize,\n      targetUnit = defaultTargetUnit,\n      unitPrecision = defaultUnitPrecision,\n    } = config\n    taro.config = taro.config || {}\n    taro.config.designWidth = designWidth\n    taro.config.deviceRatio = deviceRatio\n    taro.config.baseFontSize = baseFontSize\n    taro.config.targetUnit = targetUnit\n    taro.config.unitPrecision = unitPrecision\n  }\n}\n\nexport function getPxTransform (taro) {\n  return function (size) {\n    const config = taro.config || {}\n    const baseFontSize = config.baseFontSize\n    const deviceRatio = config.deviceRatio || defaultDesignRatio\n    const designWidth = ((input = 0) => isFunction(config.designWidth)\n      ? config.designWidth(input)\n      : config.designWidth || defaultDesignWidth)(size)\n    if (!(designWidth in deviceRatio)) {\n      throw new Error(`deviceRatio 配置中不存在 ${designWidth} 的设置！`)\n    }\n    const targetUnit = config.targetUnit || defaultTargetUnit\n    const unitPrecision = config.unitPrecision || defaultUnitPrecision\n    const formatSize = ~~size\n    let rootValue = 1 / deviceRatio[designWidth]\n    switch (targetUnit) {\n      case 'rem':\n        rootValue *= baseFontSize * 2\n        break\n      case 'px':\n        rootValue *= 2\n        break\n    }\n    let val = formatSize / rootValue\n    if (unitPrecision >= 0 && unitPrecision <= 100) {\n      val = Number(val.toFixed(unitPrecision))\n    }\n    return val + targetUnit\n  }\n}\n"],"names":[],"mappings":";;AAEM,SAAU,QAAQ,CAAE,OAAO,EAAA;AAC/B,IAAA,OAAO,OAAO;AAChB;AAEM,SAAU,UAAU,CAAE,OAAO,EAAA;IACjC,OAAO,UAAU,GAAQ,EAAE,GAAY,EAAA;AACrC,QAAA,OAAO,CAAC,WAAW,GAAG,QAAQ,CAAC,GAAG;AAChC,cAAE;AACF,cAAE;gBACA,CAAC,GAAG,GAAG;aACR;AACL,KAAC;AACH;AAEA,MAAM,kBAAkB,GAAG,GAAG;AAC9B,MAAM,kBAAkB,GAAG;IACzB,GAAG,EAAE,IAAI,GAAG,CAAC;AACb,IAAA,GAAG,EAAE,CAAC;IACN,GAAG,EAAE,IAAI,GAAG;CACb;AACD,MAAM,mBAAmB,GAAG,EAAE;AAC9B,MAAM,oBAAoB,GAAG,CAAC;AAC9B,MAAM,iBAAiB,GAAG,KAAK;AAEzB,SAAU,kBAAkB,CAAE,IAAI,EAAA;AACtC,IAAA,OAAO,UAAU,MAAM,EAAA;QACrB,MAAM,EACJ,WAAW,GAAG,kBAAkB,EAChC,WAAW,GAAG,kBAAkB,EAChC,YAAY,GAAG,mBAAmB,EAClC,UAAU,GAAG,iBAAiB,EAC9B,aAAa,GAAG,oBAAoB,GACrC,GAAG,MAAM;QACV,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,IAAI,EAAE;AAC/B,QAAA,IAAI,CAAC,MAAM,CAAC,WAAW,GAAG,WAAW;AACrC,QAAA,IAAI,CAAC,MAAM,CAAC,WAAW,GAAG,WAAW;AACrC,QAAA,IAAI,CAAC,MAAM,CAAC,YAAY,GAAG,YAAY;AACvC,QAAA,IAAI,CAAC,MAAM,CAAC,UAAU,GAAG,UAAU;AACnC,QAAA,IAAI,CAAC,MAAM,CAAC,aAAa,GAAG,aAAa;AAC3C,KAAC;AACH;AAEM,SAAU,cAAc,CAAE,IAAI,EAAA;AAClC,IAAA,OAAO,UAAU,IAAI,EAAA;AACnB,QAAA,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,IAAI,EAAE;AAChC,QAAA,MAAM,YAAY,GAAG,MAAM,CAAC,YAAY;AACxC,QAAA,MAAM,WAAW,GAAG,MAAM,CAAC,WAAW,IAAI,kBAAkB;AAC5D,QAAA,MAAM,WAAW,GAAG,CAAC,CAAC,KAAK,GAAG,CAAC,KAAK,UAAU,CAAC,MAAM,CAAC,WAAW;AAC/D,cAAE,MAAM,CAAC,WAAW,CAAC,KAAK;cACxB,MAAM,CAAC,WAAW,IAAI,kBAAkB,EAAE,IAAI,CAAC;AACnD,QAAA,IAAI,EAAE,WAAW,IAAI,WAAW,CAAC,EAAE;AACjC,YAAA,MAAM,IAAI,KAAK,CAAC,sBAAsB,WAAW,CAAA,KAAA,CAAO,CAAC;;AAE3D,QAAA,MAAM,UAAU,GAAG,MAAM,CAAC,UAAU,IAAI,iBAAiB;AACzD,QAAA,MAAM,aAAa,GAAG,MAAM,CAAC,aAAa,IAAI,oBAAoB;AAClE,QAAA,MAAM,UAAU,GAAG,CAAC,CAAC,IAAI;QACzB,IAAI,SAAS,GAAG,CAAC,GAAG,WAAW,CAAC,WAAW,CAAC;QAC5C,QAAQ,UAAU;AAChB,YAAA,KAAK,KAAK;AACR,gBAAA,SAAS,IAAI,YAAY,GAAG,CAAC;gBAC7B;AACF,YAAA,KAAK,IAAI;gBACP,SAAS,IAAI,CAAC;gBACd;;AAEJ,QAAA,IAAI,GAAG,GAAG,UAAU,GAAG,SAAS;QAChC,IAAI,aAAa,IAAI,CAAC,IAAI,aAAa,IAAI,GAAG,EAAE;YAC9C,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;;QAE1C,OAAO,GAAG,GAAG,UAAU;AACzB,KAAC;AACH;;;;"}