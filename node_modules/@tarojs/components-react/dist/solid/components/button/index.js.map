{"version":3,"file":"index.js","sources":["../../../../src/components/button/index.tsx"],"sourcesContent":["import './style/index.scss'\n\nimport classNames from 'classnames'\n\nimport { createForwardRefComponent, omit } from '../../utils'\nimport { useCallback, useEffect, useRef, useState } from '../../utils/hooks'\n\nimport type React from 'react'\n\ninterface IProps extends Omit<React.ButtonHTMLAttributes<HTMLButtonElement>, 'type'> {\n  size?: string\n  plain?: boolean\n  hoverClass?: string\n  hoverStartTime?: number\n  hoverStayTime?: number\n  disabled?: boolean\n  loading?: boolean\n  type?: string\n  className?: string\n  forwardedRef?: React.MutableRefObject<HTMLButtonElement>\n  onClick?: (e: React.MouseEvent<HTMLButtonElement>) => void\n}\n\ninterface IState {\n  hover: boolean\n  touch: boolean\n}\n\nfunction Button (props: IProps) {\n  const startTimer = useRef<ReturnType<typeof setTimeout>>()\n  const endTimer = useRef<ReturnType<typeof setTimeout>>()\n  const [state, setState] = useState<IState>({\n    hover: false,\n    touch: false\n  })\n\n  useEffect(() => {\n    return () => {\n      startTimer.current && clearTimeout(startTimer.current)\n      endTimer.current && clearTimeout(endTimer.current)\n    }\n  }, [])\n\n  const _onTouchStart = (e: React.TouchEvent<HTMLButtonElement>) => {\n    setState((e) => ({\n      ...e,\n      touch: true\n    }))\n    if (props.hoverClass && props.hoverClass !== 'none' && !props.disabled) {\n      startTimer.current = setTimeout(() => {\n        if ((state as IState).touch) {\n          setState((e) => ({\n            ...e,\n            hover: true\n          }))\n        }\n      }, props.hoverStartTime || 20)\n    }\n    props.onTouchStart && props.onTouchStart(e)\n  }\n\n  const _onTouchEnd = (e: React.TouchEvent<HTMLButtonElement>) => {\n    setState((e) => ({\n      ...e,\n      touch: false\n    }))\n    if (props.hoverClass && props.hoverClass !== 'none' && !props.disabled) {\n      endTimer.current = setTimeout(() => {\n        if (!(state as IState).touch) {\n          setState((e) => ({\n            ...e,\n            hover: false\n          }))\n        }\n      }, props.hoverStayTime || 70)\n    }\n    props.onTouchEnd && props.onTouchEnd(e)\n  }\n\n  const { forwardedRef, plain = false, children, disabled = false, className, style, onClick, hoverClass = 'button-hover', loading = false, type = 'default', size, ...restProps } = props\n\n  const handleClick = useCallback(\n    (e: React.MouseEvent<HTMLButtonElement>) => {\n      if (disabled) return // 如果按钮不可用，直接返回\n      onClick?.(e) // 否则执行点击回调\n    },\n    [disabled, onClick]\n  )\n\n  const cls = classNames(\n    className,\n    'taro-button-core',\n    {\n      [`${hoverClass}`]: (state as IState).hover && !disabled,\n      'taro-btn-disabled': disabled,\n      'taro-btn-loading': loading,\n      'taro-btn-plain': plain,\n      'taro-btn-mini': size === 'mini',\n      'taro-btn-default': type === 'default',\n      'taro-btn-primary': type === 'primary',\n      'taro-btn-warn': type === 'warn'\n    }\n  )\n\n  return (\n    <button\n      {...omit(restProps, ['hoverClass', 'onTouchStart', 'onTouchEnd', 'type', 'loading', 'forwardedRef', 'size', 'plain', 'disabled', 'onClick'])}\n      type={type}\n      size={size}\n      disabled={disabled}\n      ref={forwardedRef}\n      className={cls}\n      style={style}\n      onClick={handleClick}\n      onTouchStart={_onTouchStart}\n      onTouchEnd={_onTouchEnd}\n      loading={loading.toString()}\n      plain={plain.toString()}\n    >\n      {!!loading && <i className='weui-loading' />}\n      {children}\n    </button>\n  )\n}\n\nexport default createForwardRefComponent(Button)\n"],"names":["Button","props","startTimer","useRef","endTimer","state","setState","useState","hover","touch","useEffect","current","clearTimeout","_onTouchStart","e","Object","assign","hoverClass","disabled","setTimeout","hoverStartTime","onTouchStart","_onTouchEnd","hoverStayTime","onTouchEnd","forwardedRef","plain","children","className","style","onClick","loading","type","size","restProps","__rest","handleClick","useCallback","cls","classNames","_el$","_tmpl$","_$use","_$spread","_$mergeProps","omit","toString","_$insert","_tmpl$2","createForwardRefComponent"],"mappings":"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"}