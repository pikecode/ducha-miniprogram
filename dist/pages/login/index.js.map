{"version":3,"file":"pages/login/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1cA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACdA;AACA;;AAEA;;AAQA;;AAQA;AAYA;AAAA;AAKA;AAAA;AAAA;AACA;AACA;;AAEA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AAAA;AATA;AAWA;;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAGA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAGA;AAAA;AAAA;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAxDA;AAAA;AAAA;AAAA;AA0DA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AACA;AANA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAIA;;AAEA;;;;;;;;;;;;;;ACtHA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACvFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://ducha-miniprogram/./src/pages/login/index.tsx?56bb","webpack://ducha-miniprogram/._src_pages_login_index.tsx","webpack://ducha-miniprogram/._src_utils_api.ts","webpack://ducha-miniprogram/._src_utils_config.ts","webpack://ducha-miniprogram/._node_modules_@babel_runtime_helpers_esm_asyncToGenerator.js","webpack://ducha-miniprogram/._node_modules_@babel_runtime_helpers_esm_objectSpread2.js","webpack://ducha-miniprogram/._node_modules_@babel_runtime_helpers_esm_regenerator.js","webpack://ducha-miniprogram/._node_modules_@babel_runtime_helpers_esm_regeneratorDefine.js"],"sourcesContent":["import _regenerator from \"/Users/peak/work/ducha-miniprogram/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _objectSpread from \"/Users/peak/work/ducha-miniprogram/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"/Users/peak/work/ducha-miniprogram/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/Users/peak/work/ducha-miniprogram/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/peak/work/ducha-miniprogram/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _callSuper from \"/Users/peak/work/ducha-miniprogram/node_modules/@babel/runtime/helpers/esm/callSuper.js\";\nimport _inherits from \"/Users/peak/work/ducha-miniprogram/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _defineProperty from \"/Users/peak/work/ducha-miniprogram/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport { Component } from 'react';\nimport { View, Text, Button, Image, Input } from '@tarojs/components';\nimport Taro from '@tarojs/taro';\nimport { apiClient } from '../../utils/api';\nimport { API_CONFIG } from '../../utils/config';\nimport './index.scss';\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nvar Login = /*#__PURE__*/function (_Component) {\n  function Login(props) {\n    var _this;\n    _classCallCheck(this, Login);\n    _this = _callSuper(this, Login, [props]);\n    // 检查登录状态\n    _defineProperty(_this, \"checkLoginStatus\", function () {\n      var userInfo = Taro.getStorageSync('userInfo');\n      var phoneNumber = Taro.getStorageSync('phoneNumber');\n      if (userInfo && phoneNumber) {\n        // 已登录，直接跳转到首页\n        Taro.reLaunch({\n          url: '/pages/index/index'\n        });\n      }\n    });\n    // 获取手机号\n    _defineProperty(_this, \"getPhoneNumber\", function (e) {\n      console.log('获取手机号回调', e);\n      if (e.detail.code) {\n        // 保存手机号加密数据\n        _this.setState({\n          phoneEncryptedData: {\n            code: e.detail.code,\n            encryptedData: e.detail.encryptedData,\n            iv: e.detail.iv\n          }\n        });\n        Taro.showToast({\n          title: '手机号授权成功',\n          icon: 'success'\n        });\n\n        // 开始登录流程\n        _this.performLogin();\n      } else {\n        Taro.showToast({\n          title: '手机号授权失败',\n          icon: 'none'\n        });\n      }\n    });\n    // 执行登录\n    _defineProperty(_this, \"performLogin\", /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n      var _this$state, wxLoginCode, phoneEncryptedData, userInfo, loginParams, response, _response$data, token, serverUserInfo, _t;\n      return _regenerator().w(function (_context) {\n        while (1) switch (_context.p = _context.n) {\n          case 0:\n            _this$state = _this.state, wxLoginCode = _this$state.wxLoginCode, phoneEncryptedData = _this$state.phoneEncryptedData, userInfo = _this$state.userInfo;\n            if (!(!wxLoginCode || !phoneEncryptedData)) {\n              _context.n = 1;\n              break;\n            }\n            Taro.showToast({\n              title: '登录信息不完整',\n              icon: 'none'\n            });\n            return _context.a(2);\n          case 1:\n            _this.setState({\n              isLogging: true\n            });\n            _context.p = 2;\n            Taro.showLoading({\n              title: '正在登录...'\n            });\n\n            // 调用登录接口\n            loginParams = {\n              username: _this.state.inputPhoneNumber,\n              // 用户输入的手机号\n              captcha: wxLoginCode,\n              cryptoCode: JSON.stringify(phoneEncryptedData),\n              channel: API_CONFIG.CHANNEL\n            };\n            console.log('登录参数:', loginParams);\n            _context.n = 3;\n            return apiClient.login(loginParams);\n          case 3:\n            response = _context.v;\n            console.log('登录响应:', response);\n            if (!response.success) {\n              _context.n = 4;\n              break;\n            }\n            // 登录成功\n            _response$data = response.data, token = _response$data.token, serverUserInfo = _response$data.userInfo; // 保存登录信息\n            Taro.setStorageSync('token', token);\n            Taro.setStorageSync('userInfo', _objectSpread(_objectSpread({}, userInfo), serverUserInfo));\n            Taro.setStorageSync('phoneNumber', serverUserInfo.phone);\n\n            // 设置API客户端token\n            apiClient.setAuthToken(token);\n            _this.setState({\n              phoneNumber: serverUserInfo.phone,\n              hasPhoneNumber: true,\n              currentStep: 4\n            });\n            Taro.hideLoading();\n            Taro.showToast({\n              title: '登录成功',\n              icon: 'success'\n            });\n\n            // 跳转到首页\n            setTimeout(function () {\n              Taro.reLaunch({\n                url: '/pages/index/index'\n              });\n            }, 1500);\n            _context.n = 5;\n            break;\n          case 4:\n            throw new Error(response.message || '登录失败');\n          case 5:\n            _context.n = 7;\n            break;\n          case 6:\n            _context.p = 6;\n            _t = _context.v;\n            console.error('登录失败:', _t);\n            Taro.hideLoading();\n            Taro.showToast({\n              title: _t.message || '登录失败',\n              icon: 'none'\n            });\n          case 7:\n            _context.p = 7;\n            _this.setState({\n              isLogging: false\n            });\n            return _context.f(7);\n          case 8:\n            return _context.a(2);\n        }\n      }, _callee, null, [[2, 6, 7, 8]]);\n    })));\n    // 手机号输入处理\n    _defineProperty(_this, \"handlePhoneInput\", function (e) {\n      _this.setState({\n        inputPhoneNumber: e.detail.value\n      });\n    });\n    // 验证手机号格式\n    _defineProperty(_this, \"validatePhoneNumber\", function (phone) {\n      var phoneRegex = /^1[3-9]\\d{9}$/;\n      return phoneRegex.test(phone);\n    });\n    // 确认手机号，进入下一步\n    _defineProperty(_this, \"handlePhoneConfirm\", function () {\n      var inputPhoneNumber = _this.state.inputPhoneNumber;\n      if (!inputPhoneNumber) {\n        Taro.showToast({\n          title: '请输入手机号',\n          icon: 'none'\n        });\n        return;\n      }\n      if (!_this.validatePhoneNumber(inputPhoneNumber)) {\n        Taro.showToast({\n          title: '请输入正确的手机号',\n          icon: 'none'\n        });\n        return;\n      }\n\n      // 进入手机号验证步骤\n      _this.setState({\n        currentStep: 3\n      });\n    });\n    // 获取微信登录凭证\n    _defineProperty(_this, \"handleWechatLogin\", function () {\n      Taro.login({\n        success: function success(loginRes) {\n          console.log('微信登录成功', loginRes);\n          if (loginRes.code) {\n            // 保存微信登录code\n            _this.setState({\n              wxLoginCode: loginRes.code\n            });\n            console.log('获取到登录凭证：', loginRes.code);\n            Taro.showToast({\n              title: '获取登录凭证成功',\n              icon: 'success'\n            });\n\n            // 进入用户信息授权步骤\n            _this.setState({\n              currentStep: 1.5\n            });\n          }\n        },\n        fail: function fail(err) {\n          console.log('微信登录失败', err);\n          Taro.showToast({\n            title: '登录失败',\n            icon: 'none'\n          });\n        }\n      });\n    });\n    // 获取用户信息授权\n    _defineProperty(_this, \"handleGetUserProfile\", function () {\n      if (_this.state.canIUseGetUserProfile) {\n        Taro.getUserProfile({\n          desc: '用于完善会员资料',\n          success: function success(profileRes) {\n            console.log('获取用户信息成功', profileRes);\n            _this.setState({\n              userInfo: profileRes.userInfo,\n              hasUserInfo: true\n            });\n\n            // 保存用户信息\n            Taro.setStorageSync('userInfo', profileRes.userInfo);\n            Taro.showToast({\n              title: '授权成功',\n              icon: 'success'\n            });\n\n            // 进入下一步：输入手机号\n            _this.setState({\n              currentStep: 2\n            });\n          },\n          fail: function fail(profileErr) {\n            console.log('获取用户信息失败', profileErr);\n            Taro.showToast({\n              title: '授权失败',\n              icon: 'none'\n            });\n          }\n        });\n      } else {\n        // 兼容旧版本\n        Taro.getUserInfo({\n          success: function success(profileRes) {\n            console.log('获取用户信息成功', profileRes);\n            _this.setState({\n              userInfo: profileRes.userInfo,\n              hasUserInfo: true,\n              currentStep: 2\n            });\n            Taro.setStorageSync('userInfo', profileRes.userInfo);\n          }\n        });\n      }\n    });\n    _this.state = {\n      userInfo: {},\n      hasUserInfo: false,\n      canIUseGetUserProfile: Boolean(Taro.getUserProfile),\n      phoneNumber: '',\n      hasPhoneNumber: false,\n      wxLoginCode: '',\n      phoneEncryptedData: null,\n      isLogging: false,\n      inputPhoneNumber: '',\n      currentStep: 1\n    };\n    return _this;\n  }\n  _inherits(Login, _Component);\n  return _createClass(Login, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      Taro.setNavigationBarTitle({\n        title: '登录'\n      });\n\n      // 检查是否已登录\n      this.checkLoginStatus();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state2 = this.state,\n        userInfo = _this$state2.userInfo,\n        currentStep = _this$state2.currentStep,\n        inputPhoneNumber = _this$state2.inputPhoneNumber,\n        isLogging = _this$state2.isLogging;\n      return /*#__PURE__*/_jsxs(View, {\n        className: \"login\",\n        children: [/*#__PURE__*/_jsxs(View, {\n          className: \"login-header\",\n          children: [/*#__PURE__*/_jsx(View, {\n            className: \"logo\",\n            children: /*#__PURE__*/_jsx(Text, {\n              className: \"logo-icon\",\n              children: \"\\uD83E\\uDDB7\"\n            })\n          }), /*#__PURE__*/_jsx(Text, {\n            className: \"app-name\",\n            children: \"\\u7763\\u67E5\\u5C0F\\u7A0B\\u5E8F\"\n          }), /*#__PURE__*/_jsx(Text, {\n            className: \"app-desc\",\n            children: \"\\u53E3\\u8154\\u8D28\\u63A7\\u4E13\\u4E1A\\u5E73\\u53F0\"\n          })]\n        }), /*#__PURE__*/_jsxs(View, {\n          className: \"login-content\",\n          children: [currentStep === 1 && /*#__PURE__*/_jsxs(View, {\n            className: \"auth-section\",\n            children: [/*#__PURE__*/_jsxs(View, {\n              className: \"auth-info\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"auth-title\",\n                children: \"\\u5FAE\\u4FE1\\u767B\\u5F55\"\n              }), /*#__PURE__*/_jsx(Text, {\n                className: \"auth-desc\",\n                children: \"\\u83B7\\u53D6\\u767B\\u5F55\\u51ED\\u8BC1\\uFF0C\\u5F00\\u59CB\\u767B\\u5F55\\u6D41\\u7A0B\"\n              })]\n            }), /*#__PURE__*/_jsxs(Button, {\n              className: \"auth-btn wechat-btn\",\n              onClick: this.handleWechatLogin,\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"btn-icon\",\n                children: \"\\uD83D\\uDD11\"\n              }), \"\\u83B7\\u53D6\\u767B\\u5F55\\u51ED\\u8BC1\"]\n            })]\n          }), currentStep === 1.5 && /*#__PURE__*/_jsxs(View, {\n            className: \"auth-section\",\n            children: [/*#__PURE__*/_jsxs(View, {\n              className: \"auth-info\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"auth-title\",\n                children: \"\\u6388\\u6743\\u7528\\u6237\\u4FE1\\u606F\"\n              }), /*#__PURE__*/_jsx(Text, {\n                className: \"auth-desc\",\n                children: \"\\u83B7\\u53D6\\u60A8\\u7684\\u5FAE\\u4FE1\\u5934\\u50CF\\u3001\\u6635\\u79F0\\u7B49\\u57FA\\u672C\\u4FE1\\u606F\\uFF0C\\u7528\\u4E8E\\u4E2A\\u6027\\u5316\\u670D\\u52A1\"\n              })]\n            }), /*#__PURE__*/_jsxs(Button, {\n              className: \"auth-btn wechat-btn\",\n              onClick: this.handleGetUserProfile,\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"btn-icon\",\n                children: \"\\uD83D\\uDC64\"\n              }), \"\\u6388\\u6743\\u7528\\u6237\\u4FE1\\u606F\"]\n            })]\n          }), currentStep === 2 && /*#__PURE__*/_jsxs(View, {\n            className: \"auth-section\",\n            children: [/*#__PURE__*/_jsxs(View, {\n              className: \"user-info\",\n              children: [/*#__PURE__*/_jsx(Image, {\n                className: \"avatar\",\n                src: userInfo.avatarUrl,\n                mode: \"aspectFill\"\n              }), /*#__PURE__*/_jsx(Text, {\n                className: \"nickname\",\n                children: userInfo.nickName\n              })]\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"auth-info\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"auth-title\",\n                children: \"\\u8F93\\u5165\\u624B\\u673A\\u53F7\"\n              }), /*#__PURE__*/_jsx(Text, {\n                className: \"auth-desc\",\n                children: \"\\u8BF7\\u8F93\\u5165\\u60A8\\u7684\\u624B\\u673A\\u53F7\\uFF0C\\u7528\\u4E8E\\u8D26\\u53F7\\u9A8C\\u8BC1\\u548C\\u5B89\\u5168\\u767B\\u5F55\"\n              })]\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"phone-input-section\",\n              children: [/*#__PURE__*/_jsx(Input, {\n                className: \"phone-input\",\n                type: \"number\",\n                placeholder: \"\\u8BF7\\u8F93\\u5165\\u624B\\u673A\\u53F7\",\n                maxlength: 11,\n                value: inputPhoneNumber,\n                onInput: this.handlePhoneInput\n              }), /*#__PURE__*/_jsx(Button, {\n                className: \"auth-btn confirm-btn\",\n                onClick: this.handlePhoneConfirm,\n                disabled: !inputPhoneNumber,\n                children: \"\\u4E0B\\u4E00\\u6B65\"\n              })]\n            })]\n          }), currentStep === 3 && /*#__PURE__*/_jsxs(View, {\n            className: \"auth-section\",\n            children: [/*#__PURE__*/_jsxs(View, {\n              className: \"user-info\",\n              children: [/*#__PURE__*/_jsx(Image, {\n                className: \"avatar\",\n                src: userInfo.avatarUrl,\n                mode: \"aspectFill\"\n              }), /*#__PURE__*/_jsx(Text, {\n                className: \"nickname\",\n                children: userInfo.nickName\n              }), /*#__PURE__*/_jsxs(Text, {\n                className: \"phone-display\",\n                children: [\"\\u624B\\u673A\\u53F7\\uFF1A\", inputPhoneNumber]\n              })]\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"auth-info\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"auth-title\",\n                children: \"\\u624B\\u673A\\u53F7\\u9A8C\\u8BC1\"\n              }), /*#__PURE__*/_jsx(Text, {\n                className: \"auth-desc\",\n                children: \"\\u9700\\u8981\\u9A8C\\u8BC1\\u60A8\\u7684\\u624B\\u673A\\u53F7\\u4EE5\\u786E\\u4FDD\\u8D26\\u53F7\\u5B89\\u5168\"\n              })]\n            }), /*#__PURE__*/_jsxs(Button, {\n              className: \"auth-btn phone-btn\",\n              openType: \"getPhoneNumber\",\n              onGetPhoneNumber: this.getPhoneNumber,\n              disabled: isLogging,\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"btn-icon\",\n                children: \"\\uD83D\\uDCF1\"\n              }), isLogging ? '正在登录...' : '验证手机号']\n            })]\n          }), currentStep === 4 && /*#__PURE__*/_jsxs(View, {\n            className: \"success-section\",\n            children: [/*#__PURE__*/_jsxs(View, {\n              className: \"user-info\",\n              children: [/*#__PURE__*/_jsx(Image, {\n                className: \"avatar\",\n                src: userInfo.avatarUrl,\n                mode: \"aspectFill\"\n              }), /*#__PURE__*/_jsx(Text, {\n                className: \"nickname\",\n                children: userInfo.nickName\n              }), /*#__PURE__*/_jsxs(Text, {\n                className: \"phone-display\",\n                children: [\"\\u624B\\u673A\\u53F7\\uFF1A\", this.state.phoneNumber]\n              })]\n            }), /*#__PURE__*/_jsx(View, {\n              className: \"success-icon\",\n              children: \"\\u2705\"\n            }), /*#__PURE__*/_jsx(Text, {\n              className: \"success-text\",\n              children: \"\\u767B\\u5F55\\u6210\\u529F\\uFF0C\\u6B63\\u5728\\u8FDB\\u5165\\u5E94\\u7528...\"\n            })]\n          })]\n        }), /*#__PURE__*/_jsx(View, {\n          className: \"login-footer\",\n          children: /*#__PURE__*/_jsx(Text, {\n            className: \"privacy-text\",\n            children: \"\\u767B\\u5F55\\u5373\\u8868\\u793A\\u540C\\u610F\\u300A\\u7528\\u6237\\u534F\\u8BAE\\u300B\\u548C\\u300A\\u9690\\u79C1\\u653F\\u7B56\\u300B\"\n          })\n        })]\n      });\n    }\n  }]);\n}(Component);\nexport { Login as default };","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/login/index!./index.tsx\"\nvar config = {\"navigationBarTitleText\":\"登录\"};\n\n\n\nvar taroOption = createPageConfig(component, 'pages/login/index', {root:{cn:[]}}, config || {})\nif (component && component.behaviors) {\n  taroOption.behaviors = (taroOption.behaviors || []).concat(component.behaviors)\n}\nvar inst = Page(taroOption)\n\n\n\nexport default component\n","import Taro from '@tarojs/taro'\nimport { API_CONFIG, REQUEST_TIMEOUT } from './config'\n\n// 接口响应类型\ninterface ApiResponse<T = any> {\n  code: number\n  message: string\n  data: T\n  success: boolean\n}\n\n// 登录请求参数\ninterface LoginParams {\n  username: string    // 手机号\n  captcha: string     // 小程序登录的code\n  cryptoCode: string  // 手机号加密数据\n  channel: string     // 渠道标识：miniprogram\n}\n\n// 登录响应数据\ninterface LoginResponseData {\n  token: string\n  userInfo: {\n    id: string\n    username: string\n    nickname: string\n    avatar: string\n    phone: string\n  }\n}\n\n// 封装请求方法\nclass ApiClient {\n\n  private baseURL: string\n\n  constructor() {\n    this.baseURL = API_CONFIG.BASE_URL\n  }\n\n  // 通用请求方法\n  private async request<T>(\n    url: string,\n    method: 'GET' | 'POST' | 'PUT' | 'DELETE' = 'GET',\n    data?: any,\n    headers?: Record<string, string>\n  ): Promise<ApiResponse<T>> {\n\n    const fullUrl = `${this.baseURL}${url}`\n\n    try {\n      console.log('发起请求:', {\n        url: fullUrl,\n        method,\n        data,\n        headers\n      })\n\n      const response = await Taro.request({\n        url: fullUrl,\n        method,\n        data,\n        header: {\n          'Content-Type': 'application/json',\n          ...headers\n        },\n        timeout: REQUEST_TIMEOUT\n      })\n\n      console.log('接口响应:', response)\n\n      // 检查HTTP状态码\n      if (response.statusCode !== 200) {\n        throw new Error(`HTTP错误: ${response.statusCode}`)\n      }\n\n      const result = response.data as ApiResponse<T>\n\n      // 检查业务状态码\n      if (!result.success && result.code !== 200) {\n        throw new Error(result.message || '请求失败')\n      }\n\n      return result\n\n    } catch (error) {\n      console.error('接口请求失败:', error)\n\n      // 显示错误提示\n      Taro.showToast({\n        title: error.message || '网络请求失败',\n        icon: 'none',\n        duration: 2000\n      })\n\n      throw error\n    }\n  }\n\n  // 登录接口\n  async login(params: LoginParams): Promise<ApiResponse<LoginResponseData>> {\n    return this.request<LoginResponseData>(\n      API_CONFIG.ENDPOINTS.OAUTH_LOGIN,\n      'POST',\n      params\n    )\n  }\n\n  // 设置请求头（用于设置token等）\n  setAuthToken(token: string) {\n    // 可以在这里设置全局token\n    console.log('设置认证token:', token)\n  }\n}\n\n// 导出API客户端实例\nexport const apiClient = new ApiClient()\n\n// 导出类型\nexport type { LoginParams, LoginResponseData, ApiResponse }","// API配置\nexport const API_CONFIG = {\n  // 接口域名\n  BASE_URL: 'https://bi.hskj.cc',\n\n  // 接口路径\n  ENDPOINTS: {\n    // 登录接口\n    OAUTH_LOGIN: '/api/v1/users/oauthlogin'\n  },\n\n  // 渠道标识\n  CHANNEL: 'miniprogram'\n}\n\n// 请求超时时间\nexport const REQUEST_TIMEOUT = 10000","function asyncGeneratorStep(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c),\n      u = i.value;\n  } catch (n) {\n    return void e(n);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator(n) {\n  return function () {\n    var t = this,\n      e = arguments;\n    return new Promise(function (r, o) {\n      var a = n.apply(t, e);\n      function _next(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n);\n      }\n      function _throw(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n);\n      }\n      _next(void 0);\n    });\n  };\n}\nexport { _asyncToGenerator as default };","import defineProperty from \"./defineProperty.js\";\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread2(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\nexport { _objectSpread2 as default };","import regeneratorDefine from \"./regeneratorDefine.js\";\nfunction _regenerator() {\n  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */\n  var e,\n    t,\n    r = \"function\" == typeof Symbol ? Symbol : {},\n    n = r.iterator || \"@@iterator\",\n    o = r.toStringTag || \"@@toStringTag\";\n  function i(r, n, o, i) {\n    var c = n && n.prototype instanceof Generator ? n : Generator,\n      u = Object.create(c.prototype);\n    return regeneratorDefine(u, \"_invoke\", function (r, n, o) {\n      var i,\n        c,\n        u,\n        f = 0,\n        p = o || [],\n        y = !1,\n        G = {\n          p: 0,\n          n: 0,\n          v: e,\n          a: d,\n          f: d.bind(e, 4),\n          d: function d(t, r) {\n            return i = t, c = 0, u = e, G.n = r, a;\n          }\n        };\n      function d(r, n) {\n        for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) {\n          var o,\n            i = p[t],\n            d = G.p,\n            l = i[2];\n          r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0));\n        }\n        if (o || r > 1) return a;\n        throw y = !0, n;\n      }\n      return function (o, p, l) {\n        if (f > 1) throw TypeError(\"Generator is already running\");\n        for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) {\n          i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u);\n          try {\n            if (f = 2, i) {\n              if (c || (o = \"next\"), t = i[o]) {\n                if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\");\n                if (!t.done) return t;\n                u = t.value, c < 2 && (c = 0);\n              } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1);\n              i = e;\n            } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break;\n          } catch (t) {\n            i = e, c = 1, u = t;\n          } finally {\n            f = 1;\n          }\n        }\n        return {\n          value: t,\n          done: y\n        };\n      };\n    }(r, o, i), !0), u;\n  }\n  var a = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  t = Object.getPrototypeOf;\n  var c = [][n] ? t(t([][n]())) : (regeneratorDefine(t = {}, n, function () {\n      return this;\n    }), t),\n    u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c);\n  function f(e) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, regeneratorDefine(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e;\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, regeneratorDefine(u, \"constructor\", GeneratorFunctionPrototype), regeneratorDefine(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", regeneratorDefine(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), regeneratorDefine(u), regeneratorDefine(u, o, \"Generator\"), regeneratorDefine(u, n, function () {\n    return this;\n  }), regeneratorDefine(u, \"toString\", function () {\n    return \"[object Generator]\";\n  }), (_regenerator = function _regenerator() {\n    return {\n      w: i,\n      m: f\n    };\n  })();\n}\nexport { _regenerator as default };","function _regeneratorDefine(e, r, n, t) {\n  var i = Object.defineProperty;\n  try {\n    i({}, \"\", {});\n  } catch (e) {\n    i = 0;\n  }\n  _regeneratorDefine = function regeneratorDefine(e, r, n, t) {\n    function o(r, n) {\n      _regeneratorDefine(e, r, function (e) {\n        return this._invoke(r, n, e);\n      });\n    }\n    r ? i ? i(e, r, {\n      value: n,\n      enumerable: !t,\n      configurable: !t,\n      writable: !t\n    }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2));\n  }, _regeneratorDefine(e, r, n, t);\n}\nexport { _regeneratorDefine as default };"],"names":[],"sourceRoot":""}